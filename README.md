# Проектная работа "Веб-ларек"
https://github.com/Volobueva-Kristina/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Для сборки используется webpack.

Инструменты линтинга и форматирования подключены.

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

После клонирования проекта установить зависимости:
```
npm install
```
Для запуска проекта в режиме разработки выполнить команду:
```
npm run start
```

или

```
yarn
yarn start
```

и открыть в браузере страницу по адресу http://localhost:8080

## Сборка
Для сборки проекта в продакшен выполнить команду:
```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемых в приложении

Карточка продукта

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
  indexInBasket?: string;
}
```

Коллекция продуктов
```
interface IProductData {
  items: IProduct[];
  getCards(): IProduct[];
}
```

Данные пользователя в форме ввода контактных данных

```
interface IContacts {
	email: string;
	phone: string;
}
```

Данные пользователя в форме выбора способа оплаты и ввода адреса

```
interface IOrderPayment {
	payment: string;
  address: string;
}
```

Оформление заказа

```
interface IOrder extends IContacts, IOrderPayment {
  total: number;
  items: string[];
}
```

Корзина товаров

```
interface IBasket {
  items: IProduct[];
  totalPrice: number | null;
}
```

Главная страница

```
interface IPage {
  items: IProduct[];
  counter: number;
}
```

Сообщение об ошибке
```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Архитектура приложения

В проекте применен принцип MVP (Model-View-Presenter), согласно которому код разделен на слои:
- слой представления: отвечает за отображение данных на странице.
- слой данных: отвечает за хранение и изменение данных.
- презентер: отвечает за связь представления и данных.

### Базовый код

#### Класс EventEmitter
Класс EventEmitter обеспечивает работу событий. Его функции: возможность установить и снять слушатели событий, вызвать слушатели при возникновении события.
Класс имеет методы:
 `on` ,  `off` ,  `emit` — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы:
- `onAll` и  `offAll`  — для подписки на все события и сброса всех
подписчиков.
- `trigger` , генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы.

#### Класс Api
Класс Api - в классе реализована базовая логика отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов:
```
constructor(baseUrl: string, options: RequestInit = {}).
```
Методы:
- Метод `handleResponse` обрабатывает ответ от сервера, возвращает response.json() или сообщение об ошибке.
- Метод `get` выполняет GET запрос, используется для получения данных от сервера.
- Метод `post` используется для отправки данных на сервер.

#### Класс Component
Класс Component - Абстрактный класс для создания компонентов интерфейса. Наследуется классами представления.
```
protected constructor(protected readonly container: HTMLElement)
```
Методы:
- Метод `toggleClass` переключает класс.
- Метод `setText` установливает текстовое содержимое.
- Метод `setDisabled` сменяет статус блокировки.
- Метод `setHidden` скрывает элемент, устанавливая display = 'none'.
- Метод `setVisible` показывает элемент removeProperty('display');
- Метод `setImage` устанавливает изображение с алтернативным текстом.
- Метод `render` возвращает корневой DOM-элемент.

### Слой данных
#### Класс ProductData
Класс ProductData - отвечает за хронение и логику работы с данными товаров. Конструктор класса принимает инстант брокера событий.
Данные полей класса:
- _items - массив объектов товаров
- _preview - id карточки, выбранной для просмотра в модальном окне;
- events: IEvents - Экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Методы для взаимодействия с данными:
- `getCard` - возвращает карточку по id;
- `getProductsList` - получает список товаров;
- `setPreview` - выбор карточки для отображения в можальном окне;
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс BasketData
Класс BasketData - отвечает за хронение и логику работы с данными корзины товаров. Конструктор класса принимает инстант брокера событий.
Данные полей класса:
- basket - список товаров добавленных пользователем в корзину и общая стоимость товаров в корзине;
- events: IEvents - Экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Методы для взаимодействия с данными:
- `addtoBasket` - добавить товар в корзину, вызывает событие обновления корзины;
- `removeFromBasket` - удалить товар из корзины, вызывает событие обновления корзины;
- `getProductsList` - получает список товаров в корзине;
- `clearBasket` - очищает корзину;
- `updateBasket` - обновляет корзину;
- `getTotalPrice` - получает итоговую стоимость товаров в корзине;
- `getStatusAddingToBasket` - возвращает статус наличия или отсутствия карточки в корзине.
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс UserData
Класс UserData - отвечает за хронение и логику работы с данными информации о пользователе. Конструктор класса принимает инстант брокера событий.
Данные полей класса:
- userInfo - электронная почта пользователя,телефон пользователя, выбранный пользователем способ оплаты, адрес пользователя;
- events: IEvents - Экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Методы для взаимодействия с данными:
- `getUserContacts` - получает контакты пользователя: телефон и электронную почту;
- `getUserPayment` - получает контакты пользователя: способ оплаты и адрес;
- `setOrderField` и `setContactsField` - изменение полей ввода;
- `validateOrder` и `validateContacts` - проверяет объект с данными пользователя на валидность;
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

### Классы представления
Классы представления отвечают за отображение внутри контейнера передаваемых в них данных.

#### Класс Modal
Класс Modal - реализует модальное окно, которое может отображать произвольный контент. Наследуется от класса Component. Устанавливает слушатели для закрытия модального окна по клику вне модального окна, по клику на иконку «Закрыть» (крестик).
Методы:
- `openModal` - открытие модальное окна;
- `closeModal` - закрытие модального окна;
- `set content` - добавление внутреннего контента модального окна.
- `render` - как параметр передается контент классов, соответствующих контентам-шаблонам.

```
constructor(container: HTMLFormElement, protected events: IEvents)
```
`EventEmitter` для инициализации событий.

Поля класса:
- modal: HTMLElement - элемент модального окна;
- events: IEvents - брокер событий.

#### Класс Form
Класс Form - расширяет класс Component и является абстрактным классом. Устанавливает слушатель на изменение значений полей. С

```
constructor(protected container: HTMLFormElement, protected events: IEvents)
```

Данные полей класса:
- _submit: HTMLButtonElement - кнопка сабмита формы.
- _errors: HTMLElement;

Методы:
- `onInputChange` - добавляет телефон
- `render` - рендер переданных элементов
- `set valid` - изменяет активность кнопки подтверждения
- `set errors` - устанавливает текст ошибки

#### Класс Contacts
Класс Contacts - реализует компонент формы, который отображает форму ввода данных пользователя: Телефон и почту, расширяет класс Form.

```
constructor(container: HTMLFormElement, protected events: EventEmitter)
```
Данные полей класса:
- _emailInput: инпут почты;
- _phoneInput - инпут телефона.


#### Класс Order
Класс Order - реализует компонент формы, которая отображает форму ввода данных пользователя: способ оплаты и адрес доставки, расширяет класс Form.

```
constructor(protected container: HTMLFormElement, protected events: IEvents)
```
Данные полей класса:
- _cardButton: кнопка выбора способо оплаты картой
- _cashButton: кнопка выбора способо оплаты наличными
- _addressInput: инпут адреса.

Методы:
- `set payment` - добавляет выбранный способ оплаты, меняет класс кнопки на активный.

#### Класс Success
Класс Success - реализует компонент формы, которая отображает итоговую стоимость заказа, и кнопку возврата к главной странице (закрытие формы).

```
constructor(container: HTMLElement, actions: ISuccessActions)
```
Данные полей класса:
- _description - итоговая стоимость
- _close: HTMLButtonElement - кнопка закрытия модального окна;

Методы:
- `set total` - добавляет итоговую стоимость товаров.
- `get total` - получить итоговую стоимость товаров.
`EventEmitter` для инициализации событий.


#### Класс Basket
Класс Basket - реализует компонент корзины, которая отображает, список выбранных товаров, итоговую стоимость заказа, и кнопку оформления заказа.

```
constructor(container: HTMLElement, protected events: EventEmitter)
```
Данные полей класса:
- _list: - список добавленных в корзину товаров;
- _total: - итоговая стоимость;
- _button: - HTMLButtonElement - кнопка оформления заказа.

Методы:
- `get list` - получить список товаров.
- `set list` - добавить список товаров.
- `set total` - изменяет итоговую стоимость товаров, меняет статус кнопки.

`EventEmitter` для инициализации событий.

#### Класс Card
Класс Card - реализует компонент карточки, которая отображает различный контент.
Объект карточки имеет 3 шаблона - для показа в галерее товаров на главной странице `template id="card-catalog"`, для показа подробной информации о товаре в модальном окне `template id="card-preview"`, и шаблон для карточки в списке товаров в корзине `template id="card-basket"`. В класс карточки передается в его конструктор как параметры шаблон карточки и обработчик клика, соответствующий различным шаблонам.
Данные полей класса:
- _description - описание товара.
- _image - изображение карточки.
- _title - заголовок карточки товара.
- _category - категория товара.
- _price - цена товара.
- _indexInBasket - индекс товара для корзины.
- _button - кнопка добавления в корзину, кнопка удаления из корзины.

Добавляются случатели события на кнопку.

```
constructor(container: HTMLElement, actions?: ICardActions)
```
методы:
- `updateButtonText` - обновляет текст кнопки при добавлении или удалении из корзины.

Методы геттеры:
- title - возвращает заголовок карточки товара.
- category - возвращает категорию товара.
- price - возвращает цену товара.
- id - возвращает id товара.
- indexInBasket - возвращает индекс товара для корзины.


#### Класс Page
Page - реализует главную страницу.

Данные полей класса:
- _catalog - галерея товаров;
- _counter - счетчик товаров в корзине;
- _wrapper - для блокировки страницы при открытии модального окна
- basketIcon - иконка корзины, при нажатии на которую открывается модальное окно с содержимым корзины.

`EventEmitter` для инициализации событий.

Метод сеттер:
- `catalog` - полное обновление содержимого списка карточек, например при получении массива карточек с сервера. В конструктор принимается контейнер, в котором размещаются карточки.
- `counter` - счетчик товаров.
- `locked` - блокировка страницы при открытии модального окна

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы для реализации взаимодействия с бэкендом сервиса.

## Взаимодействие компонентов
Выполняющий роль презентера код находится в файле `index.ts`. Описывает взаимодействие между собой представления и данных. Взаимодействие осуществляется через события генерируемые брокером событий и обработчика этих событий, описанных в `index.ts`. Создаются экземпляры классов, затем настраивается обработка событий.

Список событий\
*события изменения данных (генерируются классами моделями данных)*
- `card:select` - выбор карточки товара, которая отобразиться в модальном окне
- `preview:changed` - Открыть выбранную карточку
- `basket:change` - изменение данных в корзине.
- `catalogCards:change` - изменение каталога товаров, заполнение каталога на главной странице
- `order:ready` и `contacts:ready` - валидация полей формы
- `orderFormErrors:change` и `contactsFormErrors:change` - Изменилось состояние валидации формы

*события возникающие при взаимодействии пользователя с интерфейсом (генерируются классами отвечающими за представление)*
- `basket:remove` - удаление карточки из корзины
- `basket:add` - добавление карточки в корзину
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `order.payment:change` - изменение данных в способе оплаты пользователя
- `basket:open` - открывается модальное окно с корзиной.
- `order:open` - открывается модальное окно с выбором способа оплаты и адресом.
- `order:submit` - открывается модальное окно с контактной информацией пользователя.
- `contacts:submit` - отправка формы.