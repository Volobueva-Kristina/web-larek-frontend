# Проектная работа "Веб-ларек"
https://github.com/Volobueva-Kristina/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Для сборки используется webpack.

Инструменты линтинга и форматирования подключены.

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

После клонирования проекта установить зависимости:
```
npm install
```
Для запуска проекта в режиме разработки выполнить команду:
```
npm run start
```

или

```
yarn
yarn start
```

и открыть в браузере страницу по адресу http://localhost:8080

## Сборка
Для сборки проекта в продакшен выполнить команду:
```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемых в приложении

Карточка продукта

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Коллекция продуктов
```
interface IProductData {
  items: IProduct[];
  preview: string | null;
}
```

Данные пользователя в форме ввода контактных данных

```
interface IContacts {
	email: string;
	phone: string;
}
```

Данные пользователя в форме выбора способа оплаты и ввода адреса

```
interface IOrderPayment {
	payment: string;
  address: string;
}
```

Оформление заказа

```
interface IOrder extends IContacts, IOrderPayment {
  total: number;
  items: string[];
}
```

Корзина товаров

```
interface IBasket {
  items: IProduct[];
  totalPrice: number | null;
}
```

Главная страница

```
interface IPage {
  items: IProduct[];
  counter: number;
}
```

Сообщение об ошибке
```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Архитектура приложения

В проекте применен принцип MVP (Model-View-Presenter), согласно которому код разделен на слои:
- слой представления: отвечает за отображение данных на странице.
- слой данных: отвечает за хранение и изменение данных.
- презентер: отвечает за связь представления и данных.

### Базовый код

#### Класс EventEmitter
Класс EventEmitter обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.
Класс имеет методы:
 `on` ,  `off` ,  `emit` — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы:
- `onAll` и  `offAll`  — для подписки на все события и сброса всех
подписчиков.
- `trigger` , генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы.

#### Класс Api
Класс Api - в классе реализована базовая логика отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов:
```
constructor(baseUrl: string, options: RequestInit = {}).
```
Методы:
- Метод `handleResponse` обрабатывает ответ от сервера, возвращает response.json() или сообщение об ошибке.
- Метод `get` выполняет GET запрос, используется для получения данных от сервера.
- Метод `post` используется для отправки данных на сервер.

#### Класс Component
Класс Component - Абстрактный класс для создания компонентов интерфейса. Наследуется классами представления.
```
protected constructor(protected readonly container: HTMLElement)
```
Методы:
- Метод `toggleClass` переключает класс.
- Метод `setText` установливает текстовое содержимое.
- Метод `setDisabled` сменяет статус блокировки.
- Метод `setHidden` скрывает элемент, устанавливая display = 'none'.
- Метод `setVisible` показывает элемент removeProperty('display');
- Метод `setImage` устанавливает изображение с алтернативным текстом.
- Метод `render` возвращает корневой DOM-элемент.

### Слой данных
#### Класс CardData
Класс CardData - отвечает за хронение и логику работы с данными товаров. Конструктор класса принимает инстант брокера событий.
Данные полей класса:
- _items - массив объектов товаров
- _preview - id карточки, выбранной для просмотра в модальном окне;
- events: IEvents - Экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Методы для взаимодействия с данными:
- `getCard` - возвращает карточку по id;
- `getProductsList` - получает список товаров;
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс BasketData
Класс BasketData - отвечает за хронение и логику работы с данными корзины товаров. Конструктор класса принимает инстант брокера событий.
Данные полей класса:
- _items - список товаров добавленных пользователем в корзину;
- events: IEvents - Экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Методы для взаимодействия с данными:
- `addtoBasket` - добавить товар в корзину, вызывает событие обновления корзины;
- `removeFromBasket` - удалить товар из корзины, вызывает событие обновления корзины;
- `getProductsList` - получает список товаров в корзине;
- `clearBasket` - очищает корзину;
- `updateBasket` - обновляет корзину при изменении данных: удаление карточки товара или добавления карточки товаров;
- `getTotalPrice` - получает итоговую стоимость товаров в корзине;
- `setProductsList` - добавляет список товаров в корзину;
- `getStatusAddingToBasket` - возвращает статус наличия или отсутствия карточки в корзине по id.
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс UserData
Класс UserData - отвечает за хронение и логику работы с данными информации о пользователе. Конструктор класса принимает инстант брокера событий.
Данные полей класса:
- _email - электронная почта пользователя;
- _phone - телефон пользователя;
- _payment - выбранный пользователем способ оплаты;
- _address - адрес пользователя;
- events: IEvents - Экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Методы для взаимодействия с данными:
- `getUserContacts` - получает контакты пользователя: телефон и электронную почту;
- `getUserPayment` - получает контакты пользователя: способ оплаты и адрес;
- `setUserContacts` - добавляет контакты пользователя: телефон и электронную почту;
- `setUserPayment` - добавляет контакты пользователя: способ оплаты и адрес;
- `checkUserValidationContacts` - проверяет объект с данными пользователя на валидность;
- `checkUserValidationPayment` - проверяет объект с данными пользователя на валидность;
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс PageData
PageData - отвечает за хронение и логику работы с данными информации на главной странице. Конструктор класса принимает инстант брокера событий.

Данные полей класса:
_items - список товаров;
_counter - счетчик товаров в корзине;

Методы для взаимодействия с данными:
- `setCounter` - добавляет счетчик товаров в корзине;
- `setProductList` - добавляет список товаров;
- events: IEvents - Экземпляр класса `EventEmitter` для инициализации событий при изменении данных.
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

### Классы представления
Классы представления отвечают за отображение внутри контейнера передаваемых в них данных.

#### Класс Modal
Класс Modal - реализует модальное окно, которое может отображать произвольный контент. Наследуется от класса Component. Устанавливает слушатели для закрытия модального окна по клику вне модального окна, по клику на иконку «Закрыть» (крестик).
Методы:
- `openModal` - открытие модальное окна;
- `closeModal` - закрытие модального окна;
- `set content` - добавление внутреннего контента модального окна.
- `render` - как параметр передается контент классов, соответствующих контентам-шаблонам.

```
constructor(container: HTMLFormElement, protected events: IEvents)
```
`EventEmitter` для инициализации событий.

Поля класса:
- modal: HTMLElement - элемент модального окна;
- events: IEvents - брокер событий.

#### Класс Contacts
Класс Contacts - реализует компонент формы, который отображает форму ввода данных пользователя: Телефон и почту. При сабмите инициализируется событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях инициализируется событие изменения данных.

```
constructor(container: HTMLFormElement, protected events: IEvents)
```
Данные полей класса:
- submitButton: HTMLButtonElement - кнопка сабмита формы;
- error - контейнер с сообщением об ошибке.

Методы:
- `set phone` - добавляет телефон
- `set email` - добавляет почту
- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения

`EventEmitter` для инициализации событий.

#### Класс Order
Класс Order - реализует компонент формы, которая отображает форму ввода данных пользователя: способ оплаты и адрес доставки.При сабмите инициализируется событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях инициализируется событие изменения данных.

```
constructor(container: HTMLFormElement, protected events: IEvents)
```
Данные полей класса:
- submitButton: HTMLButtonElement - кнопка сабмита формы;
- error - контейнер с сообщением об ошибке.
- buttonCard - кнопка оплаты картой.
- buttonCash - кнопка оплаты наличными.

Методы:
- `set addres` - добавляет адрес
- `set payment` - добавляет выбранный способ оплаты
- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения

`EventEmitter` для инициализации событий.

#### Класс Success
Класс Success - реализует компонент формы, которая отображает итоговую стоимость заказа, и кнопку возврата к главной странице (закрытие формы).

```
constructor(container: HTMLElement, protected events: IEvents)
```
Данные полей класса:
- totalPrice - итоговая стоимость
- button: HTMLButtonElement - кнопка закрытия модального окна;

Методы:
- `set totalPrice` - добавляет итоговую стоимость товаров.

`EventEmitter` для инициализации событий.


#### Класс Basket
Класс Basket - реализует компонент корзины, которая отображает, список выбранных товаров, итоговую стоимость заказа, и кнопку оформления заказа.

```
constructor(container: HTMLElement, protected events: IEvents)
```
Данные полей класса:
- ProductList - список добавленных в корзину товаров;
- totalPrice - итоговая стоимость;
- button: HTMLButtonElement - кнопка оформления заказа.

Методы:
- `set items` - меняет содержимое корзины.
- `set payment` - изменяет итоговую стоимость товаров.

`EventEmitter` для инициализации событий.

#### Класс Card
Класс Card - реализует компонент карточки, которая отображает различный контент.
Объект карточки имеет 3 шаблона - для показа в галерее товаров на главной странице `template id="card-catalog"`, для показа подробной информации о товаре в модальном окне `template id="card-preview"`, и шаблон для карточки в списке товаров в корзине `template id="card-basket"`. В класс карточки передается в его конструктор как параметры шаблон карточки и обработчик клика, соответствующий различным шаблонам.
Данные полей класса:
- _description - описание товара.
- _image - изображение карточки.
- _title - заголовок карточки товара.
- _category - категория товара.
- _price - цена товара.
- item-index - индекс товара для корзины.
- _button - кнопка добавления в корзину.
- _buttonDelete - кнопка удаления из корзины.

Добавляются случатели собития на кнопку.

```
constructor(container: HTMLElement, protected events: IEvents)
```
методы:
- `deleteCard(): void` - метод удаления карточки из разметки
- `setData(cardData: ICard): void` - заполняет атрибуты элементов карточки данными
- `render(): HTMLElement` - возвращает карточку с заполнеными слушателями

Методы геттеры:
- description - возвращает содержимое описания товара.
- image - возвращает изображение карточки.
- title - возвращает заголовок карточки товара.
- category - возвращает категорию товара.
- price - возвращает цену товара.
- id - возвращает id товара.

#### Класс Page
Page - реализует главную страницу.

Данные полей класса:
- itemsList - галерея товаров;
- counter - счетчик товаров в корзине;
- basketIcon - иконка корзины, при нажатии на которую открывается модальное окно с содержимым корзины.

`EventEmitter` для инициализации событий.

Метод сеттер:
- `container` - полное обновление содержимого списка карточек, например при получении массива карточек с сервера. В конструктор принимается контейнер, в котором размещаются карточки.
- `counter` - счетчик товаров.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы для реализации взаимодействия с бэкендом сервиса.

## Взаимодействие компонентов
Выполняющий роль презентера код находится в файле `index.ts`. Описывает взаимодействие между собой представления и данных. Взаимодействие осуществляется через события генерируемые брокером событий и обработчика этих событий, описанных в `index.ts`. Создаются экземпляры классов, затем настраивается обработка событий.

Список событий\
*события изменения данных (генерируются классами моделями данных)*
- `items:changed` - изменение массива карточек
- `card:selected` - изменение открываемой в модальном окне карточки
- `card:added` - изменяет статус карточки в зависимости от наличия товара в корзине. В корзине может быть только одна карточка определенного товара.

*события возникающие при взаимодействии пользователя с интерфейсом (генерируются классами отвечающими за представление)*
- `cards:selected` - выбор карточки товара, которая отобразиться в модальном окне
- `cards:delete` - удаление карточки из корзины
- `cards:add` - добавление карточки в корзину

- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна

- `order-address:input` - изменение данных в форме способа оплаты в поле ввода адреса
- `contacts-email:input` - изменение данных в форме контактов пользователя в поле ввода электронной почты
- `contacts-phone:input` - изменение данных в форме контактов пользователя в поле ввода телефона

- `contacts-form:validation` - событие, сообщающее о необходимости валидации модального окна с контактами пользователя
- `order-form:validation` - событие, сообщающее о необходимости валидации модального окна с адресом пользователя
- `isValidContacts` - валидация формы при вводе телефона и электронной почты.
- `isValidAddress` - валидация формы при вводе адреса.

- `basket:open` - открывается модальное окно с корзиной.
- `basket:change` - изменение данных в корзине.
- `basket:clear` - очистка корзины.
- `count:change` - изменение количества товара, показываемого на главной странице в иконке корзины. При добавлении товара в корзину, удалении товара из корзины.

- `order:open` - открывается модальное окно с выбором способа оплаты и адресом.
- `order:submit` - открывается модальное окно с контактной информацией пользователя.
- `contacts:submit` - отправка формы.
- `order:success` - при успешном ответе от сервера после отправки формы открывается модальное окно с информацией об оформленном заказе.